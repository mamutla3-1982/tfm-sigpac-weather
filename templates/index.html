<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>SIGPAC Weather</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="icon" href="/static/img/marker-sigpacweather.png">
<link rel="manifest" href="/static/manifest.json">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { margin:0; font-family:Arial; background:#eef2f3; }
.header { padding:10px 20px; background:#1e3d59; color:white; display:flex; justify-content:space-between; align-items:center; }
.header h2 { margin:0; display:flex; align-items:center; }
.header h2 img { height:32px; margin-right:10px; }
.view { display:none; padding:20px; }
.view.active { display:block; }
#map { width:100%; height:100%; }

/* tarjetas parcelas */
.parcela-card { width:250px; padding:15px; border:1px solid #ccc; border-radius:8px; background:white; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.parcela-card img { width:40px; float:right; }

/* layout moderno visor */
.layout {
  display: grid;
  grid-template-columns: 340px 1fr;
  height: calc(100vh - 120px); /* cabecera + margen */
  gap:0;
}

.sidebar {
  background:#f7f9fb;
  border-right:1px solid #dde3ea;
  padding:15px;
  overflow-y:auto;
}

.card {
  background:white;
  border-radius:10px;
  padding:10px;
  margin-bottom:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.06);
}
</style>
</head>

<body>

<div class="header">
    <h2><img src="/static/img/marker-sigpacweather.png">SIGPAC Weather</h2>
    <div>
        <span id="user-info"></span>
        <button id="btn-home" onclick="mostrarVista('home')">Inicio</button>
        <button id="btn-parcelas" style="display:none;" onclick="cargarParcelas()">Mis Parcelas</button>
        <button id="btn-perfil" style="display:none;" onclick="cargarPerfil()">Perfil</button>
        <button id="btn-login" onclick="mostrarVista('login')">Login</button>
        <button id="btn-register" onclick="mostrarVista('register')">Registro</button>
        <button id="btn-logout" style="display:none;" onclick="cerrarSesion()">Salir</button>
    </div>
</div>

<!-- HOME -->
<div id="view-home" class="view active">
    <h1>Bienvenido a SIGPAC Weather</h1>
    <p>Gestiona tus parcelas y consulta lluvia.</p>
</div>

<!-- LOGIN -->
<div id="view-login" class="view">
    <h3>Iniciar sesión</h3>
    <input id="login-email" placeholder="Email o usuario">
    <input id="login-password" type="password" placeholder="Contraseña">
    <button onclick="hacerLogin()">Entrar</button>
</div>

<!-- REGISTRO -->
<div id="view-register" class="view">
    <h3>Crear cuenta</h3>
    <input id="reg-username" placeholder="Usuario">
    <input id="reg-email" placeholder="Email">
    <input id="reg-password" type="password" placeholder="Contraseña">
    <input id="reg-password2" type="password" placeholder="Repetir contraseña">
    <button onclick="hacerRegistro()">Registrar</button>
</div>

<!-- APP PRINCIPAL -->
<div id="view-app" class="view">
    <button onclick="guardarParcela()">Guardar Parcela dibujada</button>
    <button onclick="cargarParcelas()">Ver Mis Parcelas</button>

    <!-- layout moderno: sidebar + mapa -->
    <div class="layout">
        <div class="sidebar" id="sidebar">
            <h2 id="parcela-nombre">Selecciona una parcela en el mapa</h2>
            <p id="parcela-info"></p>

            <div class="card">
                <h3>Lluvia diaria</h3>
                <canvas id="grafico-diario"></canvas>
            </div>

            <div class="card">
                <h3>Lluvia mensual</h3>
                <canvas id="grafico-mensual"></canvas>
            </div>

            <div class="card">
                <h3>Lluvia acumulada</h3>
                <canvas id="grafico-acumulada"></canvas>
            </div>

            <div class="card">
                <h3>Comparativa anual</h3>
                <canvas id="grafico-comparativa"></canvas>
            </div>
        </div>

        <div id="map"></div>
    </div>

    <!-- info de la parcela guardada + gráfico antiguo (lo mantenemos) -->
    <p><strong>Área dibujada:</strong> <span id="area">0</span> ha</p>
    <p id="detalle-parcela"></p>
    <div id="lluvia-info"></div>
    <canvas id="grafico-lluvia" width="400" height="200"></canvas>
</div>

<!-- PARCELAS -->
<div id="view-parcelas" class="view">
    <h2>Mis Parcelas</h2>
    <div id="parcelas-container" style="display:flex; flex-wrap:wrap; gap:15px;"></div>
</div>

<!-- PERFIL -->
<div id="view-perfil" class="view">
    <h2>Mi Perfil</h2>
    <p><strong>Usuario:</strong> <span id="perfil-username"></span></p>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

<script src="/static/js/app.js"></script>

<script>
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/static/service-worker.js");
}
</script>

</body>
</html>
