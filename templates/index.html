<div id="stats-panel" class="card" style="display:none; margin-top:20px;">
    <h3 id="stat-name" style="color:#C8943A"></h3>
    <div id="info-cruzada" style="font-size:12px; margin-bottom:15px;"></div>
    
    <div class="chart-container"><canvas id="chartDiario"></canvas></div>
    <div class="chart-container"><canvas id="chartMensual"></canvas></div>
    <div class="chart-container"><canvas id="chartAnual"></canvas></div>
    <div class="chart-container"><canvas id="chartHistorico"></canvas></div>
    
    <button onclick="document.getElementById('stats-panel').style.display='none'" style="background:#444">Cerrar</button>
</div>

<script>
// AUMENTO: L칩gica para mostrar la info de SIGPAC/AEMET y los 4 gr치ficos
async function verDetalles(id) {
    const res = await fetch(`/api/parcelas/${id}`, {
        headers: {'Authorization': 'Bearer ' + localStorage.getItem('token')}
    });
    const data = await res.json();
    
    document.getElementById('stats-panel').style.display = 'block';
    document.getElementById('stat-name').innerText = data.nombre;
    document.getElementById('info-cruzada').innerHTML = `
        <b>Provincia (SIGPAC):</b> ${data.info.sigpac.provincia}<br>
        <b>Municipio:</b> ${data.info.sigpac.municipio}<br>
        <b>Cultivo:</b> ${data.info.sigpac.cultivo}
    `;

    // Generar los 4 gr치ficos de lluvia
    generarGrafico('chartDiario', 'Lluvia Diaria (mm)', data.info.lluvia_stats.diaria, '#C8943A');
    generarGrafico('chartMensual', 'Lluvia Mensual (mm)', data.info.lluvia_stats.mensual, '#2ecc71');
    generarGrafico('chartAnual', 'Lluvia Anual (mm)', data.info.lluvia_stats.anual, '#3498db');
    generarGrafico('chartHistorico', 'Comparativa Hist칩rica', data.info.lluvia_stats.historica, '#e74c3c');
}

function generarGrafico(canvasId, etiqueta, puntos, color) {
    const ctx = document.getElementById(canvasId).getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: puntos.map(p => p.f),
            datasets: [{
                label: etiqueta,
                data: puntos.map(p => p.v),
                borderColor: color,
                tension: 0.3,
                fill: false
            }]
        },
        options: {
            scales: { y: { beginAtZero: true, ticks: {color: 'white'} }, x: { ticks: {color: 'white'} } },
            plugins: { legend: { labels: {color: 'white'} } }
        }
    });
}
</script>
