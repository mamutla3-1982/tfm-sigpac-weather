// AUMENTO: Función para arronar (lanzar) la información al hacer clic en una parcela
async function verDetalles(id) {
    const res = await fetch(`/api/parcelas/${id}/datos_completos`, {
        headers: {'Authorization': 'Bearer ' + localStorage.getItem('token')}
    });
    const result = await res.json();
    const d = result.data;

    // Mostramos la información de la base de datos en el perfil
    document.getElementById('det-panel').style.display = 'block';
    document.getElementById('det-nombre').innerText = result.parcela;
    document.getElementById('det-texto').innerHTML = `
        <b>Provincia:</b> ${d.info_sigpac.provincia}<br>
        <b>Municipio:</b> ${d.info_sigpac.municipio}<br>
        <b>Cultivo:</b> ${d.info_sigpac.cultivo}
    `;

    // AUMENTO: Generación automática de los 4 gráficos de lluvia
    pintarGrafico('chartDiario', 'Lluvia Diaria (mm)', d.graficos.diario, '#C8943A');
    pintarGrafico('chartMensual', 'Acumulado Mensual', d.graficos.mensual, '#2ecc71');
    pintarGrafico('chartAnual', 'Acumulado Anual', d.graficos.anual, '#3498db');
    pintarGrafico('chartHist', 'Histórico 10 años', d.graficos.historico, '#e74c3c');
}

function pintarGrafico(id, label, puntos, color) {
    const ctx = document.getElementById(id).getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: puntos.map(p => p.f),
            datasets: [{
                label: label,
                data: puntos.map(p => p.v),
                borderColor: color,
                tension: 0.4,
                fill: false
            }]
        },
        options: {
            scales: { y: { ticks: {color: 'white'} }, x: { ticks: {color: 'white'} } },
            plugins: { legend: { labels: {color: 'white'} } }
        }
    });
}
